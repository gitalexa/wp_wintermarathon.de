!function(t){"function"==typeof define&&define.amd?define(["window","document"],t):t(window,document)}(function(t,e){function i(t,e){return function(){return t.apply(e,arguments)}}function s(t,e){var i;for(i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])}function o(t){w(function(){var e,i;for(e=0;e<t.length;e++)i=t[e],s(i.el,i.css)})}function h(t){return t.replace(/^\s+|\s+$/g,"").toLowerCase()}function n(t,e,i){t.removeEventListener?t.removeEventListener(e,i):t.detachEvent("on"+e,i)}function r(t,e,i){n(t,e,i),t.addEventListener?t.addEventListener(e,i):t.attachEvent("on"+e,function(){i.call(t)})}function l(t){return null===t.offsetParent}function a(t){return t.offsetHeight}function f(t){return t.offsetWidth}function c(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}function u(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function p(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function m(t,e,i,s){void 0===s&&(s="wookmark-");var o=t.getAttribute("data-"+s+e);return i===!0?parseInt(o,10):o}function d(t,e,i,s){void 0===s&&(s="wookmark-"),t.setAttribute("data-"+s+e,i)}function g(t){for(var e,i={},s=[],o=t.length;o--;)e=m(t[o],"id",!0),i.hasOwnProperty(e)||(i[e]=1,s.push(t[o]));return s}function y(e,i){return void 0!==t.getComputedStyle?t.getComputedStyle(e,null).getPropertyValue(i):e.currentStyle[i]}function v(t,e){var i,s=t.length;for(i=0;s>i;i++)if(t[i]===e)return i;return-1}function C(s,o){o=o||{},"string"==typeof s&&(s=e.querySelector(s)),this.container=s,this.columns=this.containerWidth=this.resizeTimer=null,this.activeItemCount=0,this.placeholders=[],this.itemHeightsInitialized=!1,this.itemHeightsDirty=!1,this.elementTag="div",this.initItems=i(this.initItems,this),this.updateOptions=i(this.updateOptions,this),this.onResize=i(this.onResize,this),this.onRefresh=i(this.onRefresh,this),this.getItemWidth=i(this.getItemWidth,this),this.layout=i(this.layout,this),this.layoutFull=i(this.layoutFull,this),this.layoutColumns=i(this.layoutColumns,this),this.filter=i(this.filter,this),this.clear=i(this.clear,this),this.getActiveItems=i(this.getActiveItems,this),this.refreshPlaceholders=i(this.refreshPlaceholders,this),this.sortElements=i(this.sortElements,this),this.updateFilterClasses=i(this.updateFilterClasses,this),this.initItems(),this.container.style.display="block",this.updateOptions(o),this.updateFilterClasses(),this.autoResize&&r(t,"resize",this.onResize),r(this.container,"refreshWookmark",this.onRefresh)}var I={align:"center",autoResize:!0,comparator:null,direction:void 0,ignoreInactiveItems:!0,inactiveClass:"wookmark-inactive",itemSelector:void 0,itemWidth:0,fillEmptySpace:!1,flexibleWidth:0,offset:5,outerOffset:0,onLayoutChanged:void 0,placeholderClass:"wookmark-placeholder",possibleFilters:[],resizeDelay:50,verticalOffset:void 0},w=t.requestAnimationFrame||function(t){t()};return C.prototype.initItems=function(){if(void 0===this.itemSelector){for(var t,e=[],i=this.container.children,s=i.length;s--;)t=i[s],8!==t.nodeType&&(t.style.display="",d(t,"id",s),e.unshift(t));this.items=e}else this.items=this.container.querySelectorAll(this.itemSelector);this.items.length&&(this.elementTag=this.items[0].tagName),this.itemHeightsDirty=!0},C.prototype.updateFilterClasses=function(){for(var t,e,i,s,o,n=this.items.length,r={},l=this.possibleFilters,a=l.length;n--;)if(i=this.items[n],e=JSON.parse(m(i,"filter-class",!1,"")),e&&"object"==typeof e)for(t=e.length;t--;)s=h(e[t]),r.hasOwnProperty(s)||(r[s]=[]),r[s].push(i);for(;a--;)o=h(l[a]),r.hasOwnProperty(o)||(r[o]=[]);this.filterClasses=r},C.prototype.updateOptions=function(t){var e;this.itemHeightsDirty=!0,t=t||{};for(e in I)I.hasOwnProperty(e)&&(t.hasOwnProperty(e)?this[e]=t[e]:this.hasOwnProperty(e)||(this[e]=I[e]));this.verticalOffset=this.verticalOffset||this.offset,this.layout(!0)},C.prototype.onResize=function(){clearTimeout(this.resizeTimer),this.itemHeightsDirty=0!==this.flexibleWidth,this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},C.prototype.onRefresh=function(){this.itemHeightsDirty=!0,this.layout()},C.prototype.filter=function(t,e,i){var s,o,n,r,l,a=[],f=[];if(t=t||[],e=e||"or",i=i||!1,t.length){for(o=0;o<t.length;o++)l=h(t[o]),this.filterClasses.hasOwnProperty(l)&&a.push(this.filterClasses[l]);if(o=s=a.length,"or"===e||1===s)for(;o--;)f=f.concat(a[o]);else if("and"===e){for(var c,m,d,y=a[0],C=!0;o--;)a[o].length<y.length&&(y=a[o]);for(y=y||[],o=y.length;o--;){for(m=y[o],n=s,C=!0;n--&&C;)if(d=a[n],y!==d){for(c=!1,r=d.length;r--&&!c;)c=d[r]===m;C&=c}C&&(f=f.concat(y[o]))}}if(s>1&&(f=g(f)),!i)for(o=this.items.length;o--;)-1===v(f,this.items[o])&&u(this.items[o],this.inactiveClass)}else f=this.items;if(!i){for(o=f.length;o--;)p(f[o],this.inactiveClass);this.columns=null,this.layout()}return f},C.prototype.refreshPlaceholders=function(t,e){var i,o,h,n,r,l,f,c=a(this.container),u=this.columns.length,p="";if(this.placeholders.length<u){for(i=0;i<u-this.placeholders.length;i++)p+="<"+this.elementTag+' class="'+this.placeholderClass+'"/>';this.container.insertAdjacentHTML("beforeend",p),this.placeholders=this.container.querySelectorAll("."+this.placeholderClass)}for(n=this.offset+2*parseInt(y(this.placeholders[0],"border-left-width"),10)||0,n+=2*parseInt(y(this.placeholders[0],"padding-left"),10)||0,i=0;i<this.placeholders.length;i++)l=this.placeholders[i],o=this.columns[i],i>=u||0===o.length?l.style.display="none":(r=o[o.length-1],f=m(r,"top",!0)+m(r,"height",!0)+this.verticalOffset,h=Math.max(0,c-f-n),s(l,{position:"absolute",display:h>0?"block":"none",left:i*t+e+"px",top:f+"px",width:t-n+"px",height:h+"px"}))},C.prototype.getActiveItems=function(){var t,e,i=this.inactiveClass,s=[],o=this.items;if(this.ignoreInactiveItems)for(t=0;t<o.length;t++)e=o[t],c(e,i)||s.push(e);return s},C.prototype.getItemWidth=function(){var t=this.itemWidth,e=f(this.container)-20-2*this.outerOffset,i=this.flexibleWidth;if("function"==typeof t&&(t=this.itemWidth()),this.items.length>0&&(void 0===t||0===t&&!this.flexibleWidth)?t=f(this.items[0]):"string"==typeof t&&t.indexOf("%")>=0&&(t=parseFloat(t)/100*e),i){"function"==typeof i&&(i=i()),"string"==typeof i&&i.indexOf("%")>=0&&(i=parseFloat(i)/100*e);var s=e+this.offset,o=Math.floor(.5+s/(i+this.offset)),h=Math.floor(s/(t+this.offset)),n=Math.max(o,h),r=Math.max(i,Math.floor((e-(n-1)*this.offset)/n));t=Math.min(t,r)}return t},C.prototype.layout=function(t,e){if(!l(this.container)){var i,s=this.getItemWidth(),o=s+this.offset,h=f(this.container)-20,n=h-2*this.outerOffset,r=Math.floor((n+this.offset)/o),a=0,c=0,u=this.getActiveItems(),p=u.length,m=p;if(this.itemHeightsDirty||!this.itemHeightsInitialized){for(;m--;)i=u[m],this.flexibleWidth&&(i.style.width=s+"px",i.style.height=2*s/3+"px"),d(i,"height",i.offsetHeight);this.itemHeightsDirty=!1,this.itemHeightsInitialized=!0}r=Math.max(1,Math.min(r,p)),a=this.outerOffset,"center"===this.align&&(a+=Math.floor(.5+(n-(r*o-this.offset))>>1)),this.direction=this.direction||("right"===this.align?"right":"left"),c=t||null===this.columns||this.columns.length!==r||this.activeItemCount!==p?this.layoutFull(o,r,a):this.layoutColumns(o,a),this.activeItemCount=p,this.container.style.height=c+"px",this.fillEmptySpace&&this.refreshPlaceholders(o,a),void 0!==this.onLayoutChanged&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged(),"function"==typeof e&&e()}},C.prototype.sortElements=function(t){return"function"==typeof this.comparator?t.sort(this.comparator):t},C.prototype.layoutFull=function(t,e,i){var s,h,n,r,l=0,a=0,f=null,c=null,u=[],p=[],g="left"===this.align;for(this.columns=[],h=this.sortElements(this.getActiveItems()),n=h.length;u.length<e;)u.push(this.outerOffset),this.columns.push([]);for(;n>a;){for(s=h[a],f=u[0],c=0,l=0;e>l;l++)u[l]<f&&(f=u[l],c=l);d(s,"top",f),r=i,(c>0||!g)&&(r+=c*t),p[a]={el:s,css:{position:"absolute",top:f+"px"}},p[a].css[this.direction]=r+"px",u[c]+=m(s,"height",!0)+this.verticalOffset,this.columns[c].push(s),a++}return o(p),Math.max.apply(Math,u)},C.prototype.layoutColumns=function(t,e){for(var i,s,h,n,r=[],l=[],a=0,f=0,c=this.columns.length;c--;){for(i=this.outerOffset,r.push(i),s=this.columns[c],n=c*t+e,a=0;a<s.length;a++,f++)h=s[a],d(h,"top",i),l[f]={el:h,css:{top:i+"px"}},l[f].css[this.direction]=n+"px",i+=m(h,"height",!0)+this.verticalOffset;r[c]=i}return o(l),Math.max.apply(Math,r)},C.prototype.clear=function(){clearTimeout(this.resizeTimer);for(var e=this.placeholders.length;e--;)this.container.removeChild(this.placeholders[e]);n(t,"resize",this.onResize),n(this.container,"refreshWookmark",this.onRefresh)},void 0!==t.jQuery&&(jQuery.fn.wookmark=function(t){var e=this.length;if(void 0!==t&&t.container instanceof jQuery&&(t.container=t.container[0]),e>1)for(;e--;)$(this).eq(e).wookmark(t);else 1===e&&(this.wookmarkInstance?this.wookmarkInstance.updateOptions(t||{}):this.wookmarkInstance=new C(this[0],t||{}));return this}),t.Wookmark=C,C});